<!DOCTYPE html>
<html>
  <head>
    <title>Solano CI Intermittent Failed Builds With Capybara</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/syntax.css">
    <meta name="author" content="Daniel Nolan" />
    <link rel="alternate" type="application/rss+xml" title="danielnolandotcom" href="/feed.rss">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <div>
          <a class="navbar-brand" href="/">danielnolandotcom</a>
        </div>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav hidden-md hidden-lg">
          <li><a href="/">Home</a></li>
          <li><a href="/archive.html">Archive</a></li>
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
              Categories <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
              
                <li><a href="/categories/git">GIT</a></li>
              
                <li><a href="/categories/hardware">HARDWARE</a></li>
              
                <li><a href="/categories/javascript">JAVASCRIPT</a></li>
              
                <li><a href="/categories/ruby">RUBY</a></li>
              
                <li><a href="/categories/testing">TESTING</a></li>
              
                <li><a href="/categories/tmux">TMUX</a></li>
              
                <li><a href="/categories/vim">VIM</a></li>
              
                <li><a href="/categories/web">WEB</a></li>
              
            </ul>
          </li>
        </ul>
      </div>
    </nav>

  <div class="container">
    <div class="row">
      <div class="col-md-3 col-md-push-9 hidden-sm hidden-xs">
        <div class"sideBoxContent">
  <p>
  <img src="http://www.gravatar.com/avatar/1894aa33479313caba1a8d8a0bc13f3b.png" alt="..." class="img-circle">
  </p>
  <p>
  <span class="fa-stack fa-lg">
    <a href="https://github.com/danielnolan" title="Gihub">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-github-square fa-stack-1x fa-inverse"></i>
    </a>
  </span>
  <span class="fa-stack fa-lg">
    <a href="https://twitter.com/danielnolan" title="Twitter">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
    </a>
  </span>
  <span class="fa-stack fa-lg">
    <a href="https://www.linkedin.com/in/danielnolan80"
       title="Linkedin" data-proofer-ignore>
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
    </a>
  </span>
  <span class="fa-stack fa-lg">
    <a href="http://danielnolan.com/feed.rss" title="RSS">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
    </a>
  </span>
  </p>
  <h3>
    A Little About Me...
  </h3>
  <p>
  I&#39;m a web application developer, living in Florida.
  Originally from GA, I was born a Falcons and Braves fan.
  Vim is my editor of choice. I&lt;3 mechanical keyboards and the HHKB layout.
  Ruby is my language of choice, although I consider myself a full-stack
  polyglot developer. I like to try different craft beers, I prefer IPAs,
  the hoppier the better! I like to take pictures too, although I don&#39;t
  have as much time to dedicate to it as I wish I did.
  </p>
</div>
<div class="sideBoxContent hidden-sm hidden-xs">
  <h3>Categories</h3>
  <ul class="nav nav-pills nav-stacked">
    
    <li><a href="/categories/git">GIT</a></li>
    
    <li><a href="/categories/hardware">HARDWARE</a></li>
    
    <li><a href="/categories/javascript">JAVASCRIPT</a></li>
    
    <li><a href="/categories/ruby">RUBY</a></li>
    
    <li><a href="/categories/testing">TESTING</a></li>
    
    <li><a href="/categories/tmux">TMUX</a></li>
    
    <li><a href="/categories/vim">VIM</a></li>
    
    <li><a href="/categories/web">WEB</a></li>
    
  </ul>
  <h3>Archive</h3>
  <ul class="nav nav-pills nav-stacked">
    <li><a href="/archive.html">POSTS BY YEAR</a></li>
  </ul>
</div>


      </div>
      <div class="col-md-9 col-md-pull-3">
        <div class="well"><!-- grey blog post area -->

  <article class="blog-post"><!-- blog post content in here -->
    <span class="date-tag"><!-- blog post date tag wrapper -->
      <i class="fa fa-calendar"></i>
      17 August 2014
    </span>

    <h1 class="post-title">Solano CI Intermittent Failed Builds With Capybara</h1><!-- blog post H1 title -->

    <p>My company has been using Solano CI (formerly Tddium) for Continuous Integration
and Rspec/Capybara for testing our Rails apps. We have Solano CI linked to Github, whenever
we push a branch or a new commit to a branch, it kicks off a build on Solano CI and runs
all of the Rspec/Capybara specs. When I first started on this project, we were
always having problems with builds intermittently failing. However, these specs would
pass every time when running Rspec locally. A CI server is not a useful tool if it's
not reliable. I began to look into what was causing these intermittently failing builds
and I noticed that all of the failures were coming from feature specs. Since feature specs are 
handled by Capybara, I figured the failures had something to do with the way Capybara
was running on Solano CI.
After some digging and a conversation with Solano support, we were able to get the
intermittently failing builds to stop. The tests are run in parallel on Solano CI for speed,
sometimes the 2 second Capybara default wait time was not long enough. Most of
the time the builds would pass, but sometimes the content or element wasn't on the page within
the 2 seconds time causing the feature spec to fail. We changed the value from 2 seconds
to 8 seconds and kicked off a few builds. Every build that passes locally is now passing
without any issues on Solano CI. In the code example below the Capybara default wait
time is only adjusted if the ENV is set to TDDIUM.
If you need to adjust the Capybara default wait time because of intermittently
failing Capybara feature specs, just add this to your spec_helper.rb or
rails_helper.rb if you are using Rspec 3.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="k">if</span> <span class="no">ENV</span><span class="p">[</span><span class="s1">'TDDIUM'</span><span class="p">]</span> <span class="c1">#only set this config on Solano CI</span>
  <span class="c1">#set longer capybara wait time to prevent failed builds on SolanoCI</span>
  <span class="no">Capybara</span><span class="p">.</span><span class="nf">default_wait_time</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">end</span></pre></td></tr></tbody></table></code></pre></figure>


    
    <div class="blog-tags"><!-- keyword tag section -->

      <i class="fa fa-tags"></i>
      
      <a href="/tags/continuous-integration">Continuous Integration, </a>
      
      <a href="/tags/rspec">Rspec, </a>
      
      <a href="/tags/capybara">Capybara, </a>
      
      <a href="/tags/rails">Rails, </a>
      
      <a href="/tags/solano">Solano, </a>
      
      <a href="/tags/testing">Testing</a>
      
    </div>
    
  </article><!-- end post content -->
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'danielnolan'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div><!-- end grey content area -->

      </div>
    </div>
  </div>
    <script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    
</body>
</html>

